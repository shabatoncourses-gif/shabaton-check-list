<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专砖转 砖转 砖转 砖转</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .login-section {
            padding: 40px;
            text-align: center;
        }

        .login-section h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .login-section input {
            width: 100%;
            max-width: 400px;
            padding: 15px;
            font-size: 1em;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            transition: border-color 0.3s;
        }

        .login-section input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
            margin-right: 10px;
        }

        .content {
            display: none;
            padding: 30px;
        }

        .user-info {
            background: #f5f5f5;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info span {
            color: #666;
        }

        .user-info strong {
            color: #333;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 30px;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .category {
            margin-bottom: 30px;
        }

        .category-header {
            background: #f5f5f5;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .category-header:hover {
            background: #e8e8e8;
        }

        .category-header h3 {
            color: #333;
            font-size: 1.3em;
        }

        .category-progress {
            font-size: 0.9em;
            color: #666;
        }

        .tasks {
            padding-right: 20px;
        }

        .task {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: flex-start;
            transition: all 0.2s;
        }

        .task:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .task.completed {
            background: #f0f7ff;
            border-color: #667eea;
        }

        .task input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-left: 15px;
            cursor: pointer;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 1.05em;
        }

        .task.completed .task-title {
            text-decoration: line-through;
            color: #999;
        }

        .task-date {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .task-description {
            color: #666;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .task.completed .task-description {
            color: #aaa;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #667eea;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 0;
            }

            .header h1 {
                font-size: 1.5em;
            }

            .login-section {
                padding: 30px 20px;
            }

            .content {
                padding: 20px;
            }

            .btn {
                padding: 12px 30px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1> 专砖转 砖转 砖转 砖转</h1>
            <p>注拽 专  砖 砖 专 砖转 砖转 爪转</p>
        </div>

        <div class="login-section" id="loginSection">
            <h2>住 注专转</h2>
            <p style="color: #666; margin-bottom: 20px;">
                 转 转转  砖  住专 砖转   砖专<br>
                <small style="color: #999;"> 砖转 注转 转 -  砖砖 专拽 专转 </small>
            </p>
            <input type="email" id="emailInput" placeholder="your.email@example.com" required>
            <br>
            <button class="btn" onclick="login()">住</button>
            <div id="loginLoading" class="loading hidden">注 转...</div>
        </div>

        <div class="content" id="mainContent">
            <div class="user-info">
                <span>专 : <strong id="userEmail"></strong></span>
                <button class="btn btn-secondary" onclick="logout()">转转拽</button>
            </div>

            <div id="contentLoading" class="loading">注 砖转...</div>

            <div id="mainContentInner" class="hidden">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>

                <div id="categoriesContainer"></div>
            </div>
        </div>
    </div>

    <script>
        // 锔 砖: 驻 转 拽驻专爪  驻专 Firebase 砖!
        // 专转 驻专转 -README.md
        const firebaseConfig = {
            apiKey: "AIzaSyBXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdefghijklmnop"
        };

        // Initialize Firebase
        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
        } catch (error) {
            console.error("Firebase initialization error:", error);
            alert("砖 转 注专转.   砖专转 转 Firebase 拽抓.");
        }

        const tasks = {
            "拽专转 砖转 砖转": [
                {
                    id: "task-1",
                    title: "拽砖转 砖转 拽专 砖转转 驻拽转 砖专 转",
                    date: " 砖 专",
                    description: "住 注专转 拽转 转专 拽专 砖转转,  砖住转 砖转 转砖驻\", 砖 拽砖 爪 砖转. 专 - 驻拽 砖专 转 注住拽 (驻转专  转转转 注)."
                },
                {
                    id: "task-2",
                    title: "拽砖转 \"转 爪专 砖转 注住拽",
                    date: " 专 注 31.3",
                    description: "专 注 /转, 注 砖专  - 砖 拽砖 爪 砖转 注专转 驻专 注\" (爪专祝 砖专 转 拽专). 注 注转 - 拽 砖专 注住拽   注专转 \"住."
                },
                {
                    id: "task-3",
                    title: "转 注 驻住 转转 爪 砖转 (驻住 1)",
                    date: " 住祝 专抓 / 转转 驻专 - 注 31 ",
                    description: " 转 转 驻住 转转, 驻专 住 驻住, 驻专 砖 拽, 注专 住 住驻 专 注专转 拽专."
                },
                {
                    id: "task-4",
                    title: "砖转 转转  砖专 (驻住 2)",
                    date: "拽专 住转专转: 注 31 , 拽专 专: 注 31 住",
                    description: " 转转   砖, 拽祝 砖注转, 砖 住 拽 住.   拽 - 爪专祝 住住."
                }
            ],
            " 砖转 砖转": [
                {
                    id: "task-5",
                    title: "拽砖转 专 砖\" 砖专  (爪 砖转)",
                    date: "1 住驻专 - 30 专",
                    description: "砖转 爪 砖转 砖转 - 砖 拽砖 专 砖专  砖专  专 驻专 注\"."
                },
                {
                    id: "task-6",
                    title: "爪专 注 注  砖转 ",
                    date: "住驻专",
                    description: " 注 转转 注住拽 砖 砖转  -  驻住 爪专 砖 砖 砖专 驻专 注\".  爪专 :  砖爪 砖转  注 砖砖 砖专 转转 转 注住拽."
                },
                {
                    id: "task-7",
                    title: "住专转 转砖  ",
                    date: "拽专 - 专",
                    description: " 砖砖转   注 - 住专 转砖   住 专转 砖转 砖转."
                },
                {
                    id: "task-8",
                    title: "住 拽专 拽爪专转 (拽专/砖专)",
                    date: "拽专 - 专",
                    description: " 砖砖转  注 砖砖 砖专 - 驻砖专 住 拽专 拽爪专转 (拽专/砖专). 注 驻专砖 7.5% 注 2.5%, 驻专 住."
                },
                {
                    id: "task-9",
                    title: "拽砖 砖 转转 ",
                    date: "拽专 住转专转: 注 30 , 拽专 专: 注 31 爪专",
                    description: " 砖 爪专 砖 转转  - 砖 拽砖 专 注专转 拽专."
                },
                {
                    id: "task-10",
                    title: "砖转 拽砖 专 住",
                    date: "专 - 驻专专",
                    description: " \" 拽爪专 专 住 (驻住 135) 爪专祝 驻住 106 砖转拽 注."
                },
                {
                    id: "task-11",
                    title: "注 注 专 注",
                    date: "注 31.3",
                    description: "砖 注 注 专 注 砖  砖专   注住拽."
                }
            ],
            "转 砖转 砖转": [
                {
                    id: "task-12",
                    title: "砖转 拽转 拽专 砖转转",
                    date: "注 15.8",
                    description: "砖 拽转  转砖 砖专  拽  专砖 专 注专转 拽专. 专 '专 砖专  '."
                },
                {
                    id: "task-13",
                    title: "砖转 砖专 住 ",
                    date: "注 31.8",
                    description: "砖 砖专 住 拽专 砖转转 ( 砖) 砖专  (拽专住 专 /驻拽/转专)."
                },
                {
                    id: "task-14",
                    title: " 驻住 101",
                    date: "住祝 住 - 转转 住驻专",
                    description: " 驻住 101 爪 注住拽 ( 拽 驻专 注\")  转 转 住 注 砖 4 砖 ."
                },
                {
                    id: "task-15",
                    title: "注   注 专 注",
                    date: "住祝 住",
                    description: " 砖转 专转 拽注 - 注   注 专 注 (专 注 砖专). 砖 拽转 专  注  转拽."
                },
                {
                    id: "task-16",
                    title: "拽转 驻专砖 砖转 拽专 砖转转 驻住",
                    date: "拽专",
                    description: "拽 转砖 砖专转 砖 住驻专 砖爪注 驻专砖 拽专 砖转转 拽专 驻住.   - 驻转  注住拽."
                },
                {
                    id: "task-17",
                    title: "拽转 住驻转 砖转 转拽",
                    date: "拽专 - 专",
                    description: "砖 砖专 转拽 拽专 注住拽. 拽 转砖 砖注 砖转 转拽 砖转 砖转 注.  砖砖 砖专 转."
                },
                {
                    id: "task-18",
                    title: "拽转  砖转转",
                    date: "专",
                    description: "拽 砖转拽 砖专  砖转转 砖住驻 拽转  转砖 砖专转."
                },
                {
                    id: "task-19",
                    title: "拽转 拽转 注拽  ()",
                    date: "爪专 - 专",
                    description: " 注拽  -  砖注住拽 注专 转 注拽  注专 砖转 砖转,  专 砖专转 爪专."
                }
            ]
        };

        let currentUser = null;

        // Load user from Firestore
        async function loadUser() {
            try {
                // Check localStorage for cached user
                const cachedUser = localStorage.getItem('shabaton_user');
                if (cachedUser) {
                    currentUser = cachedUser;
                    showMainContent();
                    await loadTasks();
                }
            } catch (error) {
                console.log('No saved user found:', error);
            }
        }

        async function login() {
            const email = document.getElementById('emailInput').value.trim();
            if (!email || !email.includes('@')) {
                alert('  转转  转拽');
                return;
            }

            const loadingDiv = document.getElementById('loginLoading');
            const loginButton = document.querySelector('.login-section .btn');
            
            try {
                // Show loading
                loadingDiv.classList.remove('hidden');
                loginButton.disabled = true;
                
                // Save to localStorage for quick access
                localStorage.setItem('shabaton_user', email);
                currentUser = email;
                
                // Create user document in Firestore if doesn't exist
                const userRef = db.collection('users').doc(email);
                const userDoc = await userRef.get();
                
                if (!userDoc.exists) {
                    await userRef.set({
                        email: email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                
                showMainContent();
                await loadTasks();
            } catch (error) {
                console.error('Error saving user:', error);
                alert('砖 砖专转 砖转砖.  拽 转 专 专 专转 Firebase.');
                loadingDiv.classList.add('hidden');
                loginButton.disabled = false;
            }
        }

        function logout() {
            try {
                localStorage.removeItem('shabaton_user');
                currentUser = null;
                document.getElementById('loginSection').classList.remove('hidden');
                document.getElementById('mainContent').classList.add('hidden');
                document.getElementById('emailInput').value = '';
            } catch (error) {
                console.error('Error during logout:', error);
            }
        }

        function showMainContent() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('userEmail').textContent = currentUser;
            document.getElementById('contentLoading').classList.remove('hidden');
            document.getElementById('mainContentInner').classList.add('hidden');
            renderCategories();
        }

        function renderCategories() {
            const container = document.getElementById('categoriesContainer');
            container.innerHTML = '';

            for (const [category, categoryTasks] of Object.entries(tasks)) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';

                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';
                categoryHeader.innerHTML = `
                    <h3>${category}</h3>
                    <span class="category-progress" id="progress-${category}">0/${categoryTasks.length}</span>
                `;

                const tasksDiv = document.createElement('div');
                tasksDiv.className = 'tasks';

                categoryTasks.forEach(task => {
                    const taskDiv = document.createElement('div');
                    taskDiv.className = 'task';
                    taskDiv.id = task.id;

                    taskDiv.innerHTML = `
                        <input type="checkbox" onchange="toggleTask('${task.id}')">
                        <div class="task-content">
                            <div class="task-title">${task.title}</div>
                            <div class="task-date">${task.date}</div>
                            <div class="task-description">${task.description}</div>
                        </div>
                    `;

                    tasksDiv.appendChild(taskDiv);
                });

                categoryDiv.appendChild(categoryHeader);
                categoryDiv.appendChild(tasksDiv);
                container.appendChild(categoryDiv);
            }
            
            // Hide loading and show content after rendering
            document.getElementById('contentLoading').classList.add('hidden');
            document.getElementById('mainContentInner').classList.remove('hidden');
        }

        async function loadTasks() {
            const allTasks = Object.values(tasks).flat();
            
            try {
                // Load tasks from Firestore
                const tasksSnapshot = await db.collection('users')
                    .doc(currentUser)
                    .collection('tasks')
                    .get();
                
                const completedTasks = new Set();
                tasksSnapshot.forEach(doc => {
                    if (doc.data().completed) {
                        completedTasks.add(doc.id);
                    }
                });
                
                // Update UI
                for (const task of allTasks) {
                    const taskElement = document.getElementById(task.id);
                    if (taskElement && completedTasks.has(task.id)) {
                        taskElement.classList.add('completed');
                        taskElement.querySelector('input[type="checkbox"]').checked = true;
                    }
                }
                
                updateProgress();
            } catch (error) {
                console.error('Error loading tasks:', error);
                alert('砖 注转 砖转.  拽 转 专 专.');
            }
        }

        async function toggleTask(taskId) {
            const taskElement = document.getElementById(taskId);
            const checkbox = taskElement.querySelector('input[type="checkbox"]');

            try {
                const taskRef = db.collection('users')
                    .doc(currentUser)
                    .collection('tasks')
                    .doc(taskId);
                
                if (checkbox.checked) {
                    await taskRef.set({
                        completed: true,
                        completedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    taskElement.classList.add('completed');
                } else {
                    await taskRef.delete();
                    taskElement.classList.remove('completed');
                }

                updateProgress();
            } catch (error) {
                console.error('Error toggling task:', error);
                // Revert checkbox on error
                checkbox.checked = !checkbox.checked;
                alert('砖 砖专转 砖.  拽 转 专 专.');
            }
        }

        function updateProgress() {
            const allTasks = Object.values(tasks).flat();
            let completedCount = 0;

            allTasks.forEach(task => {
                const taskElement = document.getElementById(task.id);
                if (taskElement && taskElement.classList.contains('completed')) {
                    completedCount++;
                }
            });

            const percentage = Math.round((completedCount / allTasks.length) * 100);
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percentage + '%';
            progressFill.textContent = percentage + '%';

            // Update category progress
            for (const [category, categoryTasks] of Object.entries(tasks)) {
                let categoryCompleted = 0;
                categoryTasks.forEach(task => {
                    const taskElement = document.getElementById(task.id);
                    if (taskElement && taskElement.classList.contains('completed')) {
                        categoryCompleted++;
                    }
                });

                const progressElement = document.getElementById(`progress-${category}`);
                if (progressElement) {
                    progressElement.textContent = `${categoryCompleted}/${categoryTasks.length}`;
                }
            }
        }

        // Initialize on page load
        window.addEventListener('load', loadUser);
    </script>
</body>
</html>
